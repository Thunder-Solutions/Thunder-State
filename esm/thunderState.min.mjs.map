{"version":3,"file":"thunderState.min.mjs","sources":["../lib/utilities.ts","../lib/getWatchers.ts","../lib/proxy/deepProxy.ts","../lib/getGetters.ts","../lib/getRunWatchers.ts","../lib/getSetters.ts","../lib/getDispatchers.ts","../lib/timeTravel.ts","../lib/connectToDevTools.ts","../lib/createStore.ts"],"sourcesContent":["import { Key, MutationCb, MutationFn } from './types'\r\n\r\n/**\r\n * Clones an object and all its subproperties\r\n */\r\nexport const deepClone = <T>(value: T): T => {\r\n\r\n  // primitives are inherently cloned\r\n  const isPrimitive = value === null || typeof value !== 'object' && typeof value !== 'function'\r\n  if (isPrimitive) return value\r\n\r\n  // clone objects\r\n  if (typeof structuredClone !== 'undefined') return structuredClone(value)\r\n\r\n  /**\r\n   * This is a (non-optimized) fallback in case of old versions of Node.\r\n   * According to MDN, structuredClone is now supported in all modern browsers.\r\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/structuredClone\r\n   */\r\n  return JSON.parse(JSON.stringify(value))\r\n}\r\n\r\n/**\r\n * Get equivalence of any two values; objects will compare deep structure and every property's value\r\n */\r\nconst isEqual = (val1: unknown, val2: unknown) => {\r\n\r\n  // make sure they're the same type first\r\n  const sameType = typeof val1 === typeof val2\r\n  const sameConstructor = val1.constructor.name === val2.constructor.name\r\n  if (!sameType || !sameConstructor) return false\r\n\r\n  // if it's an object, check nested props for equivalence\r\n  if (typeof val1 === 'object' && typeof val2 === 'object') {\r\n\r\n    // make sure to iterate over all the keys in both objects\r\n    const keys = new Set([...Object.keys(val1), ...Object.keys(val2)])\r\n\r\n    // make sure all values are the same\r\n    for (const key of keys) {\r\n      const keyInBoth = key in val1 && key in val2\r\n      if (!keyInBoth) return false\r\n      const equal = isEqual(val1[key], val2[key])\r\n      if (!equal) return false\r\n    }\r\n\r\n    // if no mismatches were found, the objects are equal\r\n    return true\r\n  } else {\r\n\r\n    // if it's NOT an object\r\n    return val1 === val2\r\n  }\r\n}\r\n\r\n/**\r\n * Checks whether the given value is an object\r\n */\r\nexport const isObject = (val: unknown): boolean => !!val && val.toString() === '[object Object]'\r\n\r\n/**\r\n * Returns a clone of the given array without the last item\r\n */\r\nexport const withoutLast = <T>(arr: T[]): T[] => arr.slice(0, -1)\r\n\r\n/**\r\n * Trims undefined values from the beginning and end of an array\r\n */\r\nexport const trimUndef = (_arr: unknown[]): unknown[] => {\r\n  const arr = [..._arr]\r\n\r\n  // backward\r\n  for (let i = _arr.length - 1; i >= 0; i--) {\r\n    if (typeof _arr[i] === 'undefined') arr.pop()\r\n    else break\r\n  }\r\n\r\n  // forward\r\n  for (const el of _arr) {\r\n    if (typeof el === 'undefined') arr.shift()\r\n    else break\r\n  }\r\n\r\n  return arr\r\n}\r\n\r\n/**\r\n * Gets the specific error to be thrown when the state is set directly\r\n */\r\nexport const getStateSetError = () => new Error(`\r\nNot allowed to set a property on the state directly.\r\nHandle state updates by defining and dispatching actions instead.\r\n`)\r\n\r\n/**\r\n * Gets the specific error to be thrown when a computed property fails to process\r\n */\r\nexport const getComputedError = (key: Key, err: Error) => new Error(`\r\nUnable to process computed property \"${String(key)}\"\r\n  - Make sure all state properties are spelled correctly.\r\n  - If it references other computed properties, make sure they are defined before this one.\r\n  - If both of the above are valid, see the original error below.\r\n\r\nOriginal error:\r\n\r\n${err}`)\r\n\r\n/**\r\n * Gets the value at the end of the given path on the given object\r\n */\r\nexport const getValueFromPath = (obj: object, path: Key[], idx: number = 0): unknown => {\r\n\r\n  // if path is empty, just return the target\r\n  if (path.length === 0) return obj\r\n\r\n  // get prerequisite values\r\n  const key = path[idx]\r\n  const value = obj[key]\r\n  const isObj = typeof value === 'object' || typeof value === 'function'\r\n  const isLastProp = (path.length - 1) === idx\r\n\r\n  // throw an error if unable to follow the path to completion\r\n  if (!isObj && !isLastProp) throw new TypeError(\r\n'Unable to get value from path because at least one of the parent properties is not an object.')\r\n\r\n  // if this is not the final key in the path, keep running recursively\r\n  return isLastProp ? value : getValueFromPath(value, path, idx + 1)\r\n}\r\n\r\n/**\r\n * Returns a \"POJO\" (plain-old JavaScript object) from a given non-serializeable object\r\n */\r\nexport const getPojo = (obj: object): object => {\r\n\r\n  // if the provided object is an array, initialize accordingly\r\n  const initAccumulator = Array.isArray(obj) ? [] : {}\r\n\r\n  // return a POJO reduced from the provided object\r\n  return Object.keys(obj).reduce((pojo, key) => {\r\n    const value = obj[key]\r\n\r\n    // skip this property if it's a method\r\n    if (typeof value === 'function') return pojo\r\n\r\n    // if this is an object or array, get nested POJO recursively\r\n    pojo[key] = (isObject(value) || Array.isArray(value))\r\n      ? getPojo(value)\r\n      : value\r\n    return pojo\r\n  }, initAccumulator)\r\n}\r\n\r\n/**\r\n * Monkey-patches an array to capture its old and new values\r\n */\r\nexport const patchArray = (arr: unknown[], enableDevTools: boolean, mutate: MutationFn, callback: MutationCb) => {\r\n  const patchedArray = deepClone(arr)\r\n\r\n  // iterate over each property on the original Array prototype\r\n  const proto = Array.prototype\r\n  const protoKeys = Object.getOwnPropertyNames(proto)\r\n  for (const protoKey of protoKeys) {\r\n    const protoVal = proto[protoKey]\r\n\r\n    // skip this iteration if necessary\r\n    if (typeof protoVal !== 'function') continue\r\n    if (protoKey.startsWith('__')) continue\r\n    if (protoKey === 'constructor') continue\r\n\r\n    // assign a method based on the original prototype\r\n    patchedArray[protoKey] = (...args: unknown[]) => {\r\n      let result = null\r\n\r\n      mutate(arr, arr, (previouslyMutated) => {\r\n        if (enableDevTools || !previouslyMutated) {\r\n\r\n          // capture the old and new arrays\r\n          const oldArray = deepClone(arr)\r\n          result = protoVal.call(arr, ...args)\r\n          const newArray = deepClone(arr)\r\n\r\n          // only run the callback if something changed\r\n          if (!isEqual(oldArray, newArray)) {\r\n            callback(oldArray, newArray)\r\n          }\r\n        } else {\r\n          result = protoVal.call(arr, ...args)\r\n          callback(null, arr)\r\n        }\r\n      })\r\n\r\n      // return the result of the original prototype method\r\n      return result\r\n    }\r\n  }\r\n\r\n  // return the fully patched array\r\n  return patchedArray\r\n}\r\n","import { AddWatcher, Key, PrivateProps, PublicInstance, Watcher, Watchers } from './types'\r\nimport { getValueFromPath, isObject } from './utilities'\r\n\r\n/**\r\n * Get properties as \"add watcher\" methods so the end user can react to state changes\r\n */\r\nexport default ({ getters }: PublicInstance, { userDefinedWatchers }: PrivateProps) => {\r\n\r\n  // create a closure so we have access to the path in the reducer\r\n  const getReducer = (_path: Key[] = []) => (watchers, key) => {\r\n    const path = [..._path, key]\r\n\r\n    // define the add watcher method\r\n    const addWatcher: AddWatcher = (callback: Watcher) => {\r\n      userDefinedWatchers.get(addWatcher)?.add(callback)\r\n    }\r\n    const _watchers: Set<Watcher> = new Set()\r\n    userDefinedWatchers.set(addWatcher, _watchers)\r\n    watchers[key] = addWatcher\r\n    watchers[key].destroy = (watcher: Watcher) => new Promise(resolve => {\r\n\r\n      // use 0 timeout to avoid interfering with async actions\r\n      setTimeout(() => {\r\n        resolve(_watchers.delete(watcher))\r\n      })\r\n    })\r\n\r\n    // if the getter value is an object, recursively add child properties\r\n    const value = getValueFromPath(getters, path)\r\n    if (isObject(value)) {\r\n      const nestedWatchers = Object.keys(value).reduce(getReducer(path), {})\r\n      const currentWatcherObj = watchers[key]\r\n      for (const key in nestedWatchers) {\r\n        currentWatcherObj[key] = nestedWatchers[key]\r\n      }\r\n    }\r\n\r\n    // return the resulting object\r\n    return watchers\r\n  }\r\n\r\n  // kick off the reducer recursion\r\n  return Object.keys(getters).reduce(getReducer(), {})\r\n}\r\n","import { DeepProxyHandler, ProxyUtility } from './deepProxyTypes'\r\nimport { Key } from '../types'\r\nimport { isObject } from '../utilities'\r\n\r\nconst DEFAULT_HANDLER = { get: () => null, set: () => false }\r\n\r\n/** \r\n * The syntax and behavior is basically the same as the native `Proxy`.\r\n *\r\n * @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy\r\n *\r\n * This one, however, proxies all child objects infinitely deep.\r\n*/\r\nexport class DeepProxy<T extends Object> {\r\n  constructor(\r\n    target: T,\r\n    handler: DeepProxyHandler<T> = DEFAULT_HANDLER,\r\n    basePath: Key[] = [],\r\n  ) {\r\n\r\n    Object.keys(target).forEach(key => {\r\n      const path = [...basePath, key]\r\n\r\n      // a small utility for managing nested proxies efficiently\r\n      const proxyUtility: ProxyUtility = {\r\n        needsNewProxy: true,\r\n        proxy: null,\r\n        getProxy() {\r\n          if (this.needsNewProxy) {\r\n            this.needsNewProxy = false\r\n            this.proxy = Array.isArray(target[key])\r\n              ? new Proxy(target[key], {\r\n                get: (target, key) => {\r\n                  const get = handler.get ?? (() => target[key])\r\n                  return get(target, key, [...path, key])\r\n                },\r\n                set: (target, key, value) => {\r\n                  handler.set?.(target, key, value, [...path, key])\r\n                  return true\r\n                },\r\n              })\r\n              : new DeepProxy(target[key], handler, path)\r\n          }\r\n          return this.proxy\r\n        }\r\n      }\r\n\r\n      const get = () => {\r\n        if (key === '__isProxy') return true\r\n        const defaultGetter = () => target[key]\r\n        const getter = handler.get || defaultGetter\r\n        return getter(target, key, path)\r\n      }\r\n\r\n      const set = (newValue: unknown) => {\r\n\r\n        // check if this change requires setting\r\n        // a new proxy for the getter.\r\n        proxyUtility.needsNewProxy = isObject(newValue) || Array.isArray(newValue)\r\n\r\n        const defaultSetter = () => target[key] = newValue\r\n        const setter = handler.set || defaultSetter\r\n        setter(target, key, newValue, path)\r\n      }\r\n\r\n      // only use the provided getter on non-objects.\r\n      // This avoids problems with getters overriding the DeepProxy on child objects.\r\n      const proxyGetter = () => {\r\n        const valueIsObject = isObject(target[key]) || Array.isArray(target[key])\r\n        return valueIsObject ? proxyUtility.getProxy() : get()\r\n      }\r\n\r\n      Object.defineProperty(this, key, { enumerable: true, get: proxyGetter, set })\r\n    })\r\n  }\r\n}\r\n\r\n// the only purpose this serves is to get rid of the class import inside State.ts,\r\n// because Jest evidently hates classes. A lot.\r\nexport const createDeepProxy = <T extends Object>(target: T, handler: DeepProxyHandler<T>) => new DeepProxy(target, handler)\r\n","import { createDeepProxy } from './proxy/deepProxy'\r\nimport { ComputedArg, Getters, StateObj } from './types'\r\nimport { getStateSetError, getComputedError } from './utilities'\r\n\r\n/**\r\n * Get all the value getters from the state - which cannot be used to set the state\r\n */\r\nexport default (protectedState: StateObj, computed: ComputedArg): Getters => {\r\n\r\n  // proxy can only get values, but will throw an error when trying to set\r\n  const getters = createDeepProxy(\r\n    protectedState,\r\n    { set: () => { throw getStateSetError() } },\r\n  )\r\n\r\n  // add computed values to the getters proxy as well\r\n  for (const key in computed) {\r\n    Object.defineProperty(getters, key, {\r\n      enumerable: true,\r\n      get: () => {\r\n\r\n        // if this property exists as a computed value...\r\n        if (key in computed) {\r\n          try {\r\n            return computed[key](getters)\r\n          } catch (err) {\r\n            throw getComputedError(key, err)\r\n          }\r\n        }\r\n      },\r\n      set: () => { throw getStateSetError() },\r\n    })\r\n  }\r\n\r\n  // return both types of getters as one object\r\n  return getters\r\n}\r\n","import { AddWatcher, ComputedArg, Key, PrivateProps, PublicInstance, Watcher } from './types'\r\nimport { getValueFromPath, trimUndef } from './utilities'\r\n\r\n/**\r\n * Prepares the runWatchers function with prerequisite data and a closure\r\n */\r\nexport default (name: string, computed: ComputedArg, publicInstance: PublicInstance, { userDefinedWatchers, enableDevTools }: PrivateProps) => {\r\n\r\n  // store previous values from computed properties\r\n  const { getters } = publicInstance\r\n  const prevComputed = Object.keys(computed).reduce((acc, cKey) => {\r\n    const cValue = getters[cKey]\r\n    acc[cKey] = Array.isArray(cValue) ? JSON.stringify(cValue) : cValue\r\n    return acc\r\n  }, {})\r\n\r\n  /**\r\n   * The runWatchers function triggers user-defined watcher methods for the given property\r\n   */\r\n  return (target, path, _newValue) => {\r\n    const { getters, watchers } = publicInstance\r\n\r\n    // handle array watchers by passing the entire array\r\n    // instead of just the one value in the array\r\n    const parent = getValueFromPath(getters, path)\r\n    const newValue = Array.isArray(target) ? parent : _newValue\r\n    const watcherValue = Array.isArray(newValue) ? trimUndef(newValue) : newValue\r\n\r\n    // call the watchers directly attached to this property (and its parents)\r\n    for (const idxStr in path) {\r\n\r\n      // build the current full path of this iteration\r\n      const idx = Number(idxStr)\r\n      const _path: Key[] = []\r\n      for (let i = 0; i <= idx; i++) {\r\n        _path.push(path[i])\r\n      }\r\n\r\n      // call the watchers at the current path\r\n      const addWatcher = getValueFromPath(watchers, _path) as AddWatcher\r\n      const _watchers: Set<Watcher> = userDefinedWatchers.get(addWatcher) ?? new Set()\r\n      _watchers.forEach(watcher =>\r\n        watcher(watcherValue, () => { addWatcher.destroy(watcher) }))\r\n    }\r\n\r\n    // call the watchers of all computed properties that use this property\r\n    for (const cKey in computed) {\r\n      const cValue = getters[cKey]\r\n      const _cValue = Array.isArray(cValue) ? JSON.stringify(cValue) : cValue\r\n      if (prevComputed[cKey] === _cValue) continue\r\n      const cWatchers = userDefinedWatchers.get(watchers[cKey]) ?? new Set()\r\n      cWatchers.forEach(watcher =>\r\n        watcher(cValue, destroyWatcher => destroyWatcher(watcher)))\r\n\r\n      // tell the browser extension about the new computed value\r\n      if (!enableDevTools || typeof window === 'undefined') continue\r\n      window.postMessage({\r\n        type: 'thunderState_computed',\r\n        message: {\r\n          stateName: name,\r\n          key: cKey,\r\n          value: cValue,\r\n        },\r\n      }, '*')\r\n    }\r\n  }\r\n}\r\n","import { createDeepProxy } from './proxy/deepProxy'\r\nimport getGetters from './getGetters'\r\nimport getRunWatchers from './getRunWatchers'\r\nimport { ComputedArg, Key, PrivateProps, PublicInstance, Setters, StateObj } from './types'\r\nimport { patchArray, withoutLast, deepClone } from './utilities'\r\n\r\n/**\r\n * Get state as setters so we can intercept the mutations as they occur.\r\n */\r\nexport default (name: string, protectedState: StateObj, computed: ComputedArg, publicInstance: PublicInstance, privateProps: PrivateProps): Setters => {\r\n  const { enableDevTools } = privateProps\r\n\r\n  // a reusable function to add a mutation to the action entry in the history\r\n  const recordHistory = (oldValue: unknown, newValue: unknown, path: Key[], { recordMutations, actionHistory }: PrivateProps) => {\r\n    if (!recordMutations || !enableDevTools) return\r\n    actionHistory[0].mutations.push({\r\n      oldValue: deepClone(oldValue),\r\n      newValue: deepClone(newValue),\r\n      path,\r\n    })\r\n  }\r\n\r\n  // track mutations within the current event loop to prevent\r\n  // single mutations from triggering more than once.\r\n  const mutated = new Map()\r\n  const mutate = (target: object, newValue: unknown, mutateCallback: (mutated?: boolean) => void) => {\r\n\r\n    // if this isn't an array, run the mutation without extras\r\n    if (!Array.isArray(target)) {\r\n      mutateCallback()\r\n\r\n      // refresh the getters proxy if this was an array reassignment\r\n      if (Array.isArray(newValue)) {\r\n        publicInstance.getters = getGetters(protectedState, computed)\r\n      }\r\n    }\r\n\r\n    // run the mutation, pass in the \"previously mutated\" boolean\r\n    mutateCallback(mutated.get(target))\r\n\r\n    // set mutated boolean for the current thread\r\n    mutated.set(target, true)\r\n\r\n    // reset mutated boolean at the end of the event loop\r\n    setTimeout(() => {\r\n      mutated.set(target, false)\r\n    }, 0)\r\n  }\r\n\r\n  // seal and proxy the state so it's non-extensible and intercepts mutations\r\n  return Object.seal(createDeepProxy(\r\n    protectedState,\r\n    {\r\n      get: (target, key, path) => {\r\n\r\n        // if this isn't an array, just return the value normally\r\n        const targetIsArray = Array.isArray(target)\r\n        const valueIsArray = Array.isArray(target[key])\r\n        if (!targetIsArray && !valueIsArray) return target[key]\r\n\r\n        // prepare watchers before mutating the state\r\n        const runWatchers = getRunWatchers(name, computed, publicInstance, privateProps)\r\n\r\n        // monkey-patch array methods to intercept mutations\r\n        const arr = valueIsArray ? target[key] : target\r\n        const patchedArray = patchArray(arr, enableDevTools, mutate, (oldArray: unknown[], newArray: unknown[]) => {\r\n          const watcherPath = withoutLast(path)\r\n          recordHistory(oldArray, newArray, watcherPath, privateProps)\r\n          runWatchers(arr, watcherPath, newArray)\r\n        })\r\n\r\n        // return the monkey-patched array\r\n        return valueIsArray ? patchedArray : patchedArray[key]\r\n      },\r\n      set: (target, key, newValue, path) => {\r\n        const oldValue = target[key]\r\n\r\n        // do nothing if there is nothing to change\r\n        if (oldValue === newValue) return true\r\n\r\n        // prepare watchers before mutating the state\r\n        const runWatchers = getRunWatchers(name, computed, publicInstance, privateProps)\r\n\r\n        // track the mutation in the action history\r\n        recordHistory(oldValue, newValue, path, privateProps)\r\n\r\n        // apply the mutation\r\n        mutate(target, newValue, () => {\r\n          target[key] = newValue\r\n        })\r\n\r\n        // trigger the watchers for all impacted properties\r\n        const watcherPath = Array.isArray(target) ? withoutLast(path) : path\r\n        runWatchers(target, watcherPath, newValue)\r\n\r\n        // if this mutation happened as a result of time travel,\r\n        // turn \"record mutations\" back on\r\n        privateProps.recordMutations = true\r\n\r\n        // indicate success\r\n        return true\r\n      }\r\n    }\r\n  ))\r\n}\r\n","import { ActionsArg, Dispatchers, PrivateProps, PublicInstance } from './types'\r\n\r\n/**\r\n * Get dispatchers for each user-defined action\r\n */\r\nexport default (name: string, actions: ActionsArg, publicInstance: PublicInstance, { setters, queue, actionHistory, enableDevTools }: PrivateProps): Dispatchers => {\r\n  return Object.keys(actions).reduce((dispatchers, key) => {\r\n\r\n    // define the dispatcher method corresponding to the action\r\n    dispatchers[key] = async (payload: unknown) => {\r\n      const action = actions[key]\r\n\r\n      // append this action as a promise to the queue\r\n      let done: (value: void | PromiseLike<void>) => void = () => {}\r\n      queue.push(new Promise(resolve => done = resolve))\r\n      if (queue.length > 100) queue.shift()\r\n\r\n      // wait for the previous action to complete before resolving the current one\r\n      const len = queue.length\r\n      await (len > 1 ? queue[len - 2] : Promise.resolve())\r\n      const actionEntry = {name: key, payload, mutations: []}\r\n      actionHistory.unshift(actionEntry)\r\n\r\n      // run the user-defined action and pass in the necessary arguments\r\n      await action({\r\n        state: setters,\r\n        getters: publicInstance.getters,\r\n        dispatchers: publicInstance.dispatchers,\r\n        payload,\r\n      }, done)\r\n\r\n      // if the done function was not defined as a parameter, automatically call it\r\n      if (action.length < 2) done()\r\n      await queue[len - 1]\r\n\r\n      // tell the browser extension about the action and its mutations\r\n      if (!enableDevTools || typeof window === 'undefined') return\r\n      window.postMessage({\r\n        type: 'thunderState_action',\r\n        message: {\r\n          stateName: name,\r\n          name: actionEntry.name,\r\n          mutations: actionEntry.mutations,\r\n        },\r\n      }, '*')\r\n    }\r\n\r\n    // return all the dispatchers as an object\r\n    return dispatchers\r\n  }, {})\r\n}\r\n","import { PrivateProps } from './types'\r\nimport { getValueFromPath, deepClone } from './utilities'\r\n\r\n/**\r\n * The \"time travel\" function used to rewind and fast-forward actions\r\n */\r\nexport default (num: number, privateProps: PrivateProps) => {\r\n  const { setters, actionHistory, actionFuture } = privateProps\r\n\r\n  // rewind if num is negative\r\n  const isRewinding = num < 0\r\n\r\n  // get all relevant numbers for comparisons and conditions\r\n  const absNum = Math.abs(num)\r\n  const maxNum = isRewinding ? actionHistory.length : actionFuture.length\r\n  const finalIdx =\r\n    absNum >= maxNum ? maxNum - 1\r\n    : absNum > 0 ? absNum - 1 : 0\r\n  \r\n  // clone the list of actions so they can be modified during iterations\r\n  // without causing problems with the rest of the loop\r\n  const actions = isRewinding ? [...actionHistory] : [...actionFuture]\r\n\r\n  // using `some` so it stops iterating when the threshold is reached\r\n  actions.some((action, idx) => {\r\n\r\n    // determine which lists we're moving to and from\r\n    const fromActions = isRewinding ? actionHistory : actionFuture\r\n    const toActions = isRewinding ? actionFuture : actionHistory\r\n\r\n    // undo or redo all of this action's mutations\r\n    action.mutations.forEach(mutation => {\r\n\r\n      // stop recording mutations so the setters don't overwrite the action history\r\n      privateProps.recordMutations = false\r\n\r\n      // get a reference to the property in question\r\n      const { oldValue, newValue, path } = mutation\r\n      const parentPath = path.length > 1 ? path.slice(0, path.length - 1) : []\r\n      const lastKey = path[path.length - 1]\r\n      const ref = getValueFromPath(setters, parentPath)\r\n\r\n      // apply the mutation to the state\r\n      ref[lastKey] = isRewinding ? deepClone(oldValue) : deepClone(newValue)\r\n    })\r\n\r\n    // move the action from one list to the other\r\n    fromActions.shift()\r\n    toActions.unshift(action)\r\n\r\n    // stop iterating when the threshold is reached\r\n    return idx === finalIdx\r\n  })\r\n}\r\n","import { isObject, getPojo } from './utilities'\r\nimport timeTravel from './timeTravel'\r\nimport { PrivateProps, PublicInstance } from './types'\r\n\r\n/**\r\n * Prepares the \"Thunder State Dev Tools\" browser extension.\r\n */\r\nexport default (name: string, { getters }: PublicInstance, privateProps: PrivateProps) => {\r\n\r\n  // if not using browser, can't connect to dev tools; skip\r\n  if (typeof window === 'undefined') return\r\n\r\n  // send the initial state to the browser extension\r\n  window.postMessage({\r\n    type: 'thunderState_initState',\r\n    message: {\r\n      stateName: name,\r\n      state: getPojo(getters),\r\n    }\r\n  }, '*')\r\n\r\n  // update the state if time traveled from extension\r\n  window.addEventListener('message', ({ data, source }) => {\r\n    const dataIsValid = source === window && isObject(data)\r\n\r\n    // do nothing if the type or name doesn't match\r\n    const { type, stateName, message } = data\r\n    const isType = dataIsValid && type === 'thunderState_timeTravel'\r\n    if (!isType || stateName !== name) return\r\n\r\n    // establish direction and amount, then do time travel\r\n    const { index, isRewinding } = message\r\n    const lastIdx = isRewinding ? (index > 0 ? -index : -1) : index + 1\r\n    timeTravel(lastIdx, privateProps)\r\n  })\r\n}\r\n","import getWatchers from './getWatchers'\r\nimport getGetters from './getGetters'\r\nimport getSetters from './getSetters'\r\nimport getDispatchers from './getDispatchers'\r\nimport connectToDevTools from './connectToDevTools'\r\nimport { deepClone } from './utilities'\r\nimport { StoreConfig, PrivateProps, PublicInstance } from './types'\r\n\r\n// The factory function for creating a new state\r\nconst createStore = ({\r\n  actions: _actions = {},\r\n  computed: _computed = {},\r\n  ...config\r\n}: StoreConfig): PublicInstance => {\r\n\r\n  // clone so the user can't modify the state from the object reference they fed in\r\n  const {\r\n    state: protectedState = {},\r\n    name,\r\n    enableDevTools = true,\r\n  } = deepClone(config)\r\n\r\n  // shallow clone objects with methods\r\n  const actions = { ..._actions }\r\n  const computed = { ..._computed }\r\n\r\n  // keep a reference to the returned object\r\n  const publicInstance: PublicInstance = Object.seal({\r\n    getters: {},\r\n    watchers: {},\r\n    dispatchers: {},\r\n  })\r\n\r\n  // establish an internal state for tracking things privately\r\n  const privateProps: PrivateProps = {\r\n    setters: {},\r\n    queue: [],\r\n    actionHistory: [],\r\n    actionFuture: [],\r\n    recordMutations: true,\r\n    userDefinedWatchers: new Map(),\r\n    enableDevTools: enableDevTools === true,\r\n  }\r\n\r\n  // add getters to the public instance so they can be accessed externally\r\n  publicInstance.getters = getGetters(protectedState, computed)\r\n\r\n  // group \"add watcher\" methods corresponding to each property,\r\n  // so the end user can react to state changes\r\n  publicInstance.watchers = getWatchers(publicInstance, privateProps)\r\n\r\n  // setters are not accessible externally; they are injected via action methods\r\n  privateProps.setters = getSetters(name, protectedState, computed, publicInstance, privateProps)\r\n\r\n  // add dispatchers for each action defined in the state config\r\n  publicInstance.dispatchers = getDispatchers(name, actions, publicInstance, privateProps)\r\n\r\n  // connect to the browser dev tools extension\r\n  if (privateProps.enableDevTools) connectToDevTools(name, publicInstance, privateProps)\r\n\r\n  // return the public object\r\n  return publicInstance\r\n}\r\n\r\nexport default createStore\r\n"],"names":[],"mappings":"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"}